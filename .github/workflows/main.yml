name: "Run E2E Tests on Comment"
on:
  issue_comment:
    types: [created]

jobs:
  get-pr-commit-data:
    name: Get Latest PR Commit SHA
    if: github.event.issue.pull_request && contains(github.event.comment.body, '/test')
    runs-on: ubuntu-latest
    outputs:
      pr-sha: ${{ steps.pr-comment-commit-data.outputs.head_sha }}
      pr-ref: ${{ steps.pr-comment-commit-data.outputs.head_ref }}
    steps:
      - name: Get Comment Branch SHA
        uses: xt0rted/pull-request-comment-branch@v1
        id: pr-comment-commit-data

  tests-job:
    name: Tests Job
    runs-on: ubuntu-latest
    if: github.event.issue.pull_request && contains(github.event.comment.body, '/test')
    steps:
      - name: Tests Step
        run: echo "Tests step in Tests Job..."
  
  other-job:
    name: Tests Failure Job
    runs-on: ubuntu-latest
    needs: [get-pr-commit-data, tests-job]
    steps:
      - name: Update Commit Status to Job Status
        uses: myrotvorets/set-commit-status-action@master
        if: always()
        with:
          status: ${{ job.status }}
          sha: ${{ needs.get-pr-commit-data.outputs.pr-sha }}
          token: ${{ secrets.REPO_ACCESS_TOKEN }}
